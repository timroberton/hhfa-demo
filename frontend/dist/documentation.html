<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>HHFA Analysis Platform Documentation</title><link rel="stylesheet" type="text/css" href="/sourcesanspro.css"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/eb082a7df2e704e48db8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/eb082a7df2e704e48db8.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-32f2191b9eea58be8c8a.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-95c2b224bccf352ee870.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.7ec230ec27bd2df0a8e4.js" as="script"/><link rel="preload" href="/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.3f4ebeb83fce1755e5d5.js" as="script"/><link rel="preload" href="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.f0876cb8f31b77869279.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-4b6b1f16dab73d299285.js" as="script"/><link rel="preload" href="/_next/static/chunks/bbc01074681c7bd60bd96831e224632b67bbc8a0.5936f05fe5d4b62da988.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/documentation-367adf4d1a8fcbade78f.js" as="script"/></head><body><div id="__next"><div class="w-full h-full font-sourcesanspro overflow-y-auto print:overflow-y-visible print:h-auto"><a class="px-4 py-2 rounded-md flex bg-blue-800 items-center fixed top-4 right-8 hover:bg-gray-800 cursor-pointer print:hidden shadow-lg" href="/" target="_blank"><div class="text-blue-400 pb-0.5 hidden lg:block mr-2">Use the platform</div><svg style="height:1.5rem;width:1.5rem" class="text-blue-400 group-focus:text-blue-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"></path></svg></a><header class="header bg-gradient-to-br from-blue-800 to-blue-900 text-white"><nav class="w-full tex max-w-5xl mx-auto px-10 nav pt-16 pb-12" role="navigation" aria-label="main navigation"><h1 class="font-extralight text-4xl antialiased">Harmonized Health Facility Assessment</h1><h4 class="mt-3 font-semibold text-4xl antialiased text-white">Analysis Platform</h4><h4 class="mt-7 antialiased font-book text-blue-200">Documentation ~ Version 0.1 ~ 31.12.2020</h4></nav></header><main class="w-full max-w-5xl mx-auto px-10 markdown"><h2>Summary</h2><h3>Version 0.1 ~ 31.12.2020</h3><p>This is the first version of the Harmonized Health Facility Assessment Analysis Platform (the &quot;platform&quot;). It can be used to analyze a dataset, generate analysis findings, and produce tables and charts for a report. Although the platform is fully functional, we hope to continue improving it in the coming months.</p><p>The platform is designed to be used by country teams in the latter stages of a Harmonized Health Facility Assessment (HHFA) for analyzing the dataset that is generated by the HHFA survey toolkit.</p><h3>Contact</h3><p>For technical questions about the platform, contact Tim Roberton at <a href="mailto:timroberton@gmail.com">timroberton@gmail.com</a></p><h3>Objective</h3><p>The purpose of the platform is to allow HHFA stakeholders to <em>quickly and easily</em> generate analysis outputs and a draft report, without the need for specialized statistical software or expertise, while also allowing for flexibility and customizability for those that want to extend the built-in analysis.</p><p>In the ideal case, a user should simply need to:</p><ol><li>Upload their dataset,</li><li>Click &quot;Run&quot;, to analyze their dataset with the default configuration, and</li><li>View and download a report.</li></ol><p>In reality, there will likely be some customization needed in most cases. But assuming the HHFA survey tool has been used as expected, the amount of necessary customization should be minimal.</p><h3>Tutorial video and demonstration</h3><p>You can watch a tutorial video and demonstration of the platform on this page: <a href="https://tr-hhfa-1.netlify.app/tutorial">https://tr-hhfa-1.netlify.app/tutorial</a></p><h2>Using the tool</h2><p><img src="/images/a1.png" alt="a1"/></p><p><img src="/images/a2.png" alt="a2"/></p><p><img src="/images/a3.png" alt="a3"/></p><p><img src="/images/a4.png" alt="a4"/></p><h2>Configuring stratifier variables</h2><p><img src="/images/b1.png" alt="b1"/></p><p><img src="/images/b2.png" alt="b2"/></p><h2>Creating indicators</h2><p><img src="/images/c1.png" alt="c1"/></p><p><img src="/images/c2.png" alt="c2"/></p><h2>Creating analyses</h2><p><img src="/images/d1.png" alt="d1"/></p><p><img src="/images/d2.png" alt="d2"/></p><h2>Getting results</h2><p><img src="/images/e1.png" alt="e1"/></p><p><img src="/images/e2.png" alt="e2"/></p><p><img src="/images/e3.png" alt="e3"/></p><p><img src="/images/e4.png" alt="e4"/></p><p><img src="/images/e5.png" alt="e5"/></p><p><img src="/images/e6.png" alt="e6"/></p><h2>Deployment</h2><blockquote><p>NOTE: This section is for other software developers and IT staff</p></blockquote><p>There are two software components to the analysis platform: a frontend (HTML/CSS/JS) and a backend (compiled binary, containerized with R). Both components are included in this repo.</p><h3>Frontend</h3><p>The frontend is a single-page web app (client). It should be served via a regular http server. It is built using Typescript/React/Webpack, and compiled to HTML/CSS/JS. In this repo you can see the compiled HTML/CSS/JS (in the <code>/frontend</code> directory), ready to be served as a static page. Drop it in a <code>www</code> folder or use a tool such as <a href="https://www.npmjs.com/package/serve">serve</a> to serve the client.</p><p>When you navigate to the client for the first time, it will ask for the backend URL. (If you are running the backend locally using Option 1 described below, the URL will be <code>http://localhost:9000</code>.) This feature is for the demo only. If we decide on a permanent backend address, we can eliminate this step.</p><h3>Backend</h3><p>The backend server is responsible for:</p><ol><li>Temporarily storing data files uploaded from the client</li><li>Rendering analysis scripts (from parameters/data that are sent to the backend from the client)</li><li>Running the analysis scripts on the data files</li><li>Temporarily serving the statistical outputs of the analysis scripts (e.g. images, csv files)</li></ol><p>The backend is written in Rust and compiled to an executable binary. This repo contains the <em>source code only</em> for the binary (in the <code>/backend</code> directory).</p><p>You will need to compile the binary using one of the following two deployment options. <strong><em>I strongly suggest the first option.</em></strong></p><p><strong>Option 1.</strong> Build and run the backend as a Docker container. This builds the Rust binary inside the Docker image and does not require you to install Rust or R. It only requires you to install Docker.</p><p>Assuming you have Docker already installed, the build process is straightforward.</p><pre><code>cd backend
docker build -t hhfa-demo-backend .
docker run -d --rm -p 9000:9000 hhfa-demo-backend hhfa</code></pre><p>The build step may take several minutes. The first time will take longer, because Docker will need to pull the two base images used in the Dockerfile (<code>rustlang/rust:nightly</code> and <code>rocker/tidyverse:4.0.2</code>).</p><p>The resulting Docker image is large because it contains R and the tidyverse package.</p><p>When running the Docker container, you need to pass the <code>hhfa</code> command as the first and only argument (per the above code) - i.e. the container is not self-executing; you need to give it the <code>hhfa</code> command.</p><p>You can choose which port to run the backend on. The default is <code>:9000</code>, as shown above by the <code>-p 9000:9000</code> flag.</p><p><strong>Option 2.</strong> A second deployment option is to build the binary outside of Docker (using <a href="https://doc.rust-lang.org/cargo/index.html">Cargo</a>, the Rust package manager) and run it as a standalone binary executable.</p><pre><code>cd backend
mkdir sessions
cargo run --release</code></pre><p>However, this still requires you to have Docker installed for the purposes of running R. You will need to ensure that you have the R Docker image available locally (<code>rocker/tidyverse:4.0.2</code>) and that the binary has the necessary permissions to call <code>docker run</code>.</p><p>Also note that if you choose this option, you will need to create a <code>sessions</code> directory next to the binary (per the above code).</p><p>As I said, I think option 1 is the best.</p><h3>Additional notes on backend deployment</h3><p>For <strong>production</strong> deployment of the backend, we will also need to:</p><ul><li>Put behind SSL / HTTPS</li><li>Ensure uploads of up to 1 Gb (some services like NGINX restrict size of uploads by default)</li></ul><h2>Backend endpoints</h2><span><div class="breaker">.</div></span><p>The key processes of the backend can be seen in the <code>main.rs</code> source file. The URL endpoints are as follows:</p><pre><code class="language-shell"># Endpoints for creating and removing session folders
GET /new_session
GET /end_session/&lt;sessionId&gt;

# Endpoints for uploading and parsing data files
POST /upload/&lt;session_id&gt;
POST /varlist
GET /delete_upload/&lt;session_id&gt;/&lt;file_name&gt;

# Endpoints for running analyses and streaming output files
POST /render_script
POST /analyze
GET /stream_file/&lt;session_id&gt;/&lt;temp_id&gt;/&lt;file_name&gt;</code></pre><p>All endpoints return a JSON object with the same structure...</p><pre><code class="language-javascript">{
    error: boolean,
    msg: string,
    data: T,
}</code></pre><p>The only exception is the <code>/stream_file</code> endpoint, which returns the requested file as a stream, and the <code>/upload</code> endpoint, which returns an HTTP status code.</p></main><footer class="w-full"><div class="w-full max-w-5xl mx-auto px-10 pt-6 pb-12 text-blue-700 font-light"><div class="print:block hidden border-b-2 mb-3 border-blue-200"></div><div class=" print:block hidden"><div class="antialiased font-book">Tim Roberton</div><div class="antialiased font-book">timroberton@gmail.com</div><div class="antialiased font-book">+1 (443) 844 9749</div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/documentation","query":{},"buildId":"Rt9iYwIMisvU3Qo_XtCTx","runtimeConfig":{},"nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-246c4c8f803edec18188.js"></script><script src="/_next/static/chunks/main-32f2191b9eea58be8c8a.js" async=""></script><script src="/_next/static/chunks/webpack-95c2b224bccf352ee870.js" async=""></script><script src="/_next/static/chunks/framework.7ec230ec27bd2df0a8e4.js" async=""></script><script src="/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.3f4ebeb83fce1755e5d5.js" async=""></script><script src="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.f0876cb8f31b77869279.js" async=""></script><script src="/_next/static/chunks/pages/_app-4b6b1f16dab73d299285.js" async=""></script><script src="/_next/static/chunks/bbc01074681c7bd60bd96831e224632b67bbc8a0.5936f05fe5d4b62da988.js" async=""></script><script src="/_next/static/chunks/pages/documentation-367adf4d1a8fcbade78f.js" async=""></script><script src="/_next/static/Rt9iYwIMisvU3Qo_XtCTx/_buildManifest.js" async=""></script><script src="/_next/static/Rt9iYwIMisvU3Qo_XtCTx/_ssgManifest.js" async=""></script></body></html>